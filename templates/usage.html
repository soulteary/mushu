<!DOCTYPE html>
<html lang="en">

<head>
    <title>Example</title>
    <script type="text/javascript">
        function initWS() {
            let statusBar = document.getElementById("status-bar");
            if (window["WebSocket"]) {
                conn = new WebSocket("ws://" + document.location.host + "/ws");
                conn.onclose = function (evt) {
                    statusBar.innerHTML = "连接中断，请启动服务后刷新页面";
                    statusBar.style.backgroundColor = "grey";
                };
                conn.onmessage = function (evt) {
                    var messages = evt.data.split('\n');
                    for (var i = 0; i < messages.length; i++) {
                        console.log("[用户消息] " + messages[i])
                    }
                };
                conn.onopen = function (evt) {
                    statusBar.innerHTML = "连接就绪";
                    statusBar.style.backgroundColor = "green";
                };
            }
            return conn;
        }

        window.onload = function () {
            let conn = initWS();
            setInterval(() => {
                conn.send("[!MUSHU:RELOAD]")
                conn.send("[!MUSHU:DOCUMENT]")
                conn.send("[!MUSHU:SCROLL]")
                conn.send("[!MUSHU:CLICK]#hnmain .pagetop b.hnname a")
            }, 2000);
        };
    </script>
    <style>
        body {
            padding-top: 30px;
        }

        #status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            vertical-align: middle;
            text-indent: 20px;
            background-color: green;
            font-size: 12px;
            color: #fff;
            padding: 4px;
        }
    </style>
</head>

<body>
    <div id="status-bar"></div>

    <div id="log"></div>
    <form id="form">
        <input type="submit" value="Send" />
        <input type="text" id="msg" size="64" autofocus />
    </form>
</body>

</html>